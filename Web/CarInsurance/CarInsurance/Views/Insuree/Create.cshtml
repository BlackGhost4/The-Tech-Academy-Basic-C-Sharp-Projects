@model CarInsurance.ViewModels.InsureeVM
<h2>Insurer "The Happy Car"</h2>

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
    <div class="container">
        <div class="row">
            <div class="col-sm-6 col-md-6 col-lg-6">
                <div class="card col-sm-12 col-md-12 col-lg-12 mx-auto shadow">
                    <div class="card-header text-center no-gutters">
                        <h5 class="m-0">Quote</h5>
                    </div>
                    <div class="card-body">
                        <div class="container">
                            <div class="row mt-2">
                                <div class="col-sm-7 col-md-7 col-lg-7">
                                    @Html.LabelFor(model => model.FirstName, "First Name", htmlAttributes: new { @class = "control-label" })
                                </div>
                                <div class="col-sm-5 col-md-5 col-lg-5">
                                    @Html.EditorFor(model => model.FirstName, new { htmlAttributes = new { @class = "form-control" } })
                                    @Html.ValidationMessageFor(model => model.FirstName, "", new { @class = "text-danger" })
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-sm-7 col-md-7 col-lg-7">
                                    @Html.LabelFor(model => model.LastName, "Last Name", htmlAttributes: new { @class = "control-label" })
                                </div>
                                <div class="col-sm-5 col-md-5 col-lg-5">
                                    @Html.EditorFor(model => model.LastName, new { htmlAttributes = new { @class = "form-control" } })
                                    @Html.ValidationMessageFor(model => model.LastName, "", new { @class = "text-danger" })
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-sm-7 col-md-7 col-lg-7">
                                    @Html.LabelFor(model => model.EmailAddress, "Email Address", htmlAttributes: new { @class = "control-label" })
                                </div>
                                <div class="col-sm-5 col-md-5 col-lg-5">
                                    @Html.EditorFor(model => model.EmailAddress, new { htmlAttributes = new { @class = "form-control" } })
                                    @Html.ValidationMessageFor(model => model.EmailAddress, "", new { @class = "text-danger" })
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-sm-7 col-md-7 col-lg-7">
                                    @Html.LabelFor(model => model.DateOfBirth, "Date Of Birth", htmlAttributes: new { @class = "control-label" })
                                </div>
                                <div class="col-sm-5 col-md-5 col-lg-5">
                                    @Html.EditorFor(model => model.DateOfBirth,
                                        new { htmlAttributes = new { @class = "form-control", @readonly = "true" } })
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-sm-7 col-md-7 col-lg-7">
                                    @Html.LabelFor(model => model.DUI, "DUI ?", htmlAttributes: new { @class = "control-label" })
                                </div>
                                <div class="col-sm-5 col-md-5 col-lg-5">
                                    <label class="switch">
                                        @Html.CheckBoxFor(model => model.DUI, new { @class = "form-control" })
                                        <div class="slider round">
                                        </div>
                                    </label>
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-sm-7 col-md-7 col-lg-7">
                                    @Html.LabelFor(model => model.SpeedingTickets, "Sppeding Tickets", htmlAttributes: new { @class = "control-label" })
                                </div>
                                <div class="col-sm-5 col-md-5 col-lg-5">
                                    @Html.EditorFor(model => model.SpeedingTickets, new { htmlAttributes = new { @class = "form-control" } })
                                    @Html.ValidationMessageFor(model => model.SpeedingTickets, "", new { @class = "text-danger" })
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-sm-7 col-md-7 col-lg-7">
                                    @Html.LabelFor(model => model.CoverageType, "Total Coverage", htmlAttributes: new { @class = "control-label" })
                                </div>
                                <div class="col-sm-5 col-md-5 col-lg-5">
                                    <label class="switch">
                                        @Html.CheckBoxFor(model => model.CoverageType, new { @class = "form-control" })
                                        <div class="slider round">
                                        </div>
                                    </label>
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-sm-7 col-md-7 col-lg-7">
                                    @Html.LabelFor(model => model.CarYear, "Car Year", htmlAttributes: new { @class = "control-label" })
                                </div>
                                <div class="col-sm-5 col-md-5 col-lg-5">
                                    @Html.EditorFor(model => model.CarYear, new { htmlAttributes = new { @class = "form-control" } })
                                    @Html.ValidationMessageFor(model => model.CarYear, "", new { @class = "text-danger" })
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-sm-7 col-md-7 col-lg-7">
                                    @Html.LabelFor(model => model.Quote, "Monthly Cost", htmlAttributes: new { @class = "control-label" })
                                </div>
                                <div class="col-sm-5 col-md-5 col-lg-5">
                                    @Html.EditorFor(model => model.Quote, new { htmlAttributes = new { @class = "form-control", @readonly = "readonly" } })
                                    @Html.ValidationMessageFor(model => model.Quote, "", new { @class = "text-danger" })
                                </div>
                            </div>
                            <div class="row mt-4">
                                <div class="col">
                                    <input type="button" value="Calculate" class="btn btn-primary" id="requestQuote" />
                                </div>
                                <div class="col">
                                    <input type="submit" value="Apply for insurance" class="btn btn-success" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-md-6 col-lg-6">
                <div class="row">
                    <div class="card col-sm-12 col-md-12 col-lg-12 mx-auto shadow">
                        <div class="card-header text-center">
                            <h5 class="m-0">Vehicle</h5>
                        </div>
                        <div class="card-body">
                            <div class="container">
                                <div class="row mt-2">
                                    <div class="col-sm-10 col-md-10 col-lg-10 mx-auto d-flex justify-content-center text-center">
                                        @Html.DropDownListFor(m => m.CarMakes, Model.CarMakes, "Select a vehicle....", new { @class = "form-control", @onchange = "GetExtraQuoteVehicle()" })
                                        @Html.EditorFor(model => model.ExtraQuote, new { htmlAttributes = new { @class = "form-control", style = "display:none" } })
                                        @Html.EditorFor(model => model.IdCar, new { htmlAttributes = new { @class = "form-control", style = "display:none" } })
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-sm-10 col-md-10 col-lg-10 mx-auto d-flex justify-content-center">
                                        <img src="~/Images/Cars/vehicle.jpg" id="imageVehicle" width="300" height="200" />
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-sm-10 col-md-10 col-lg-10 mx-auto text-center" id="messageCostExtraVehicle" style="color:red;">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="card col-sm-12 col-md-12 col-lg-12 mx-auto shadow">
                        <div class="card-header text-center">
                            <h5 class="m-0">Quote Monthly</h5>
                        </div>
                        <div class="card-body">
                            <div class="container">
                                <div class="row mt-2">
                                    <div class="col-sm-10 col-md-10 col-lg-10 mx-auto">
                                        <div class="container" id="totalQuote">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
<div>
    @Html.ActionLink("Back to List", "Index")
</div>

@section Scripts
{
    @Scripts.Render("~/bundles/jqueryui")
    @Styles.Render("~/Content/cssjqryUi")
<script>
        $(document).ready(function () {
            $('input[type=datetime]').datepicker({
                dateFormat: "mm/dd/yy",
                changeMonth: true,
                changeYear: true,
                yearRange: "-60:+0",
            });
        });

        function GetExtraQuoteVehicle() {
            var idCar = $('#CarMakes').val();
            if (idCar.length > 0) {
                $("#IdCar").val(idCar);
                $.ajax({
                    url: '/Insuree/ExtraQuoteVehicle',
                    type: "GET",
                    dataType: "JSON",
                    data: { IdCar: idCar },
                    success: function (response) {
                        var auxExtra = response.Data.extraQuote;
                        if (auxExtra != "0") {
                            $("#messageCostExtraVehicle").html("This vehicle has an extra cost of $" + auxExtra);
                        } else {
                            $("#messageCostExtraVehicle").html("");
                        }
                        $('#imageVehicle').attr('src', '/Images/Cars/' + idCar + '.jpg');
                        $("#ExtraQuote").val(auxExtra);
                    }
                });
            } else {
                $("#ExtraQuote").val("0");
                $("#messageCostExtraVehicle").html("");
                $('#imageVehicle').attr('src', '/Images/Cars/vehicle.jpg');
            }
        }

    $('#requestQuote').click(function () {
        var aDateOfBirth = $('#DateOfBirth').val();
        var aCarYear = $('#CarYear').val();
        var aSpeedingTickets = $('#SpeedingTickets').val();
        var aDUI = $('#DUI').is(":checked");
        var aCoverageType = $('#CoverageType').is(":checked");
        var aExtraQuote = $('#ExtraQuote').val();
            var jsonInput = {
                DateOfBirth: aDateOfBirth,
                CarYear: aCarYear,
                SpeedingTickets: aSpeedingTickets,
                DUI: aDUI,
                CoverageType: aCoverageType,
                ExtraQuote: aExtraQuote
            };
            //var jsonInput = {
            //    DateOfBirth: "12/02/1980",
            //    CarYear: 2000,
            //    SpeedingTickets: 1,
            //    DUI: true,
            //    CoverageType: false,
            //    ExtraQuote: 0
            //};
            $.ajax({
                url: '/Insuree/GetTotalQuote',
                type: "GET",
                data: { jsonInput: JSON.stringify(jsonInput) },
                success: function (response) {
                    $('#Quote').val(response.quoteMonthly);
                    $('#totalQuote').html(
                        "<div class=\"row\">" +
                            "<div class=\"col-sm-8 col-md-8 col-lg-8\">Quote by Age:</div><div class=\"col\">$ " + response.quoteByAge + "</div>" +
                        "</div>" +
                        "<div class=\"row\">" +
                            "<div class=\"col-sm-8 col-md-8 col-lg-8\">Quote by Car Year:</div><div class=\"col\">$ " + response.quoteByCarYear + "</div>" +
                        "</div>" +
                        "<div class=\"row\">" +
                            "<div class=\"col-sm-8 col-md-8 col-lg-8\">Quote by Speeding Tickets:</div><div class=\"col\">$ " + response.quoteBySpeedingTickets + "</div>" +
                        "</div>" +
                        "<div class=\"row\">" +
                            "<div class=\"col-sm-8 col-md-8 col-lg-8\">Quote by Car Model:</div><div class=\"col\">$ " + response.quoteByCarModel + "</div>" +
                        "</div>" +
                        "<div class=\"row\">" +
                            "<div class=\"col-sm-8 col-md-8 col-lg-8\">Quote by DUI:</div><div class=\"col\">$ " + response.quoteByDUI + "</div>" +
                        "</div>" +
                        "<div class=\"row\">" +
                            "<div class=\"col-sm-8 col-md-8 col-lg-8\">Quote by Coverage Total:</div><div class=\"col\">$ " + response.quoteByCoverageTotal + "</div>" +
                        "</div>" +
                        "<div class=\"row\">" +
                            "<div class=\"col-sm-8 col-md-8 col-lg-8\">Quote Monthly:</div><div class=\"col\">$ " + response.quoteMonthly + "</div>" +
                        "</div>"
                    );
                }
            });
        });
</script>
}
